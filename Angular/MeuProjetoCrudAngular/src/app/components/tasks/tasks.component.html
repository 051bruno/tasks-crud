<div class="container container-fluid mt-4">
    <div class="d-flex justify-content-between mb-3">
        <h2 class="">Lista de Tarefas</h2>
        <button type="button" class="btn btn-primary btn-sm" (click)="openModal(false)">Nova Tarefa</button>
    </div>
    <table class="table table-striped table-bordered table-hover">
        <thead class="thead-light">
            <tr>
                <th class="text-center" scope="col">Ações</th>
                <th class="text-center" scope="col">Status</th>
                <th scope="col">Nome da Tarefa</th>
                <th scope="col">Descrição</th>
                <th scope="col">ID</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let task of this.tasks">
                <td class="text-center">
                    <div *ngIf="!task.isTaskConcluida; else Concluido">
                        <button title="Concluir Tarefa" class="btn btn-link p-0 border-0" (click)="toggleComplete(task)">
                            <svg width="26" height="26" viewBox="0 0 26 26" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M21.0049 8.82084L20.5722 9.74655L21.5071 10.1592C23.3872 10.989 24.068 11.9243 24.0871 12.6155C24.0971 12.9768 23.9447 13.4068 23.4945 13.8971C23.0398 14.3921 22.3266 14.894 21.3604 15.3512L20.3971 15.807L20.9133 16.7394C21.5878 17.9579 21.9703 19.0281 22.0794 19.8749C22.189 20.7252 22.012 21.2139 21.7575 21.4842C21.5051 21.7523 21.0294 21.9637 20.1837 21.9338C19.3431 21.9041 18.2659 21.6351 17.0203 21.1038L16.1377 20.7272L15.7251 21.5936C14.8075 23.5204 13.766 24.2922 12.9381 24.3203C12.0885 24.3492 10.9867 23.5963 10.0035 21.5635L9.57827 20.6844L8.68928 21.0887C7.56576 21.5996 6.60453 21.8598 5.85889 21.898C5.11399 21.9362 4.70183 21.7524 4.47782 21.5206C4.24525 21.28 4.06488 20.8316 4.12783 20.032C4.19041 19.2371 4.48865 18.223 5.04456 17.051L5.48713 16.118L4.54035 15.7056C2.6269 14.8723 1.93212 13.9265 1.91283 13.2285C1.89475 12.5747 2.45157 11.6653 4.10254 10.7654L4.94039 10.3087L4.52341 9.45036C4.00991 8.39336 3.74195 7.48292 3.69073 6.76775C3.63981 6.0567 3.80527 5.63702 4.03618 5.39174C4.27441 5.13868 4.7093 4.93671 5.47097 4.93942C6.23209 4.94213 7.21106 5.1535 8.35508 5.60106L9.2746 5.9608L9.64598 5.04592C10.1035 3.91883 10.6381 3.05864 11.1914 2.48968C11.7416 1.92382 12.2576 1.69524 12.7141 1.67971C13.5776 1.65034 14.7004 2.43016 15.6911 4.5252L16.1217 5.43567L17.0291 4.99861C18.2239 4.42309 19.2546 4.11767 20.0567 4.05745C20.8616 3.99701 21.3018 4.18724 21.5352 4.42867C21.7652 4.66662 21.9441 5.10739 21.8871 5.89133C21.8305 6.67144 21.5441 7.66742 21.0049 8.82084ZM25.0868 12.5879C25.1193 13.7664 24.217 14.878 22.6728 15.7884C22.3978 15.9506 22.1023 16.1064 21.7882 16.2551C21.9554 16.5571 22.1077 16.8543 22.2447 17.1453C23.2705 19.3256 23.4312 21.1653 22.4856 22.1696C21.4392 23.2812 19.2518 23.1429 16.6279 22.0236C15.6736 24.0276 14.3927 25.2714 12.9721 25.3197C11.4854 25.3703 10.1204 24.102 9.10327 21.999C6.72468 23.0807 4.74806 23.239 3.75884 22.2157C2.87181 21.2981 2.93279 19.5898 3.75154 17.5168C3.86659 17.2255 3.9966 16.927 4.14105 16.6225C3.91854 16.5256 3.70561 16.4246 3.50287 16.3198C1.90922 15.4958 0.945799 14.4352 0.913207 13.2561C0.878598 12.004 1.89936 10.8274 3.62394 9.88733C2.53148 7.63863 2.33995 5.73466 3.30806 4.70629C4.29451 3.65843 6.29509 3.72135 8.71942 4.6698C9.69654 2.2627 11.1022 0.733958 12.6801 0.68029C14.1525 0.630212 15.5055 1.87372 16.5194 3.94049C16.5449 3.99237 16.5701 4.04477 16.5952 4.09768C16.6646 4.06423 16.7337 4.03154 16.8025 3.99962C19.2288 2.87358 21.2501 2.695 22.2542 3.73363C23.1708 4.68189 23.0751 6.47454 22.1769 8.64156C22.0948 8.83947 22.0061 9.0405 21.9108 9.2443C22.0595 9.30992 22.2039 9.37739 22.3437 9.44661C24.0287 10.2811 25.0531 11.3714 25.0868 12.5879ZM18.7438 10.0292C18.9373 9.83217 18.9344 9.5156 18.7374 9.32211C18.5404 9.12861 18.2238 9.13147 18.0303 9.32848L11.512 15.9653L8.74377 13.1467C8.55027 12.9496 8.2337 12.9468 8.03669 13.1403C7.83968 13.3338 7.83683 13.6504 8.03032 13.8474L11.1553 17.0292C11.2493 17.1249 11.3779 17.1788 11.512 17.1788C11.6462 17.1788 11.7748 17.1249 11.8688 17.0292L18.7438 10.0292Z"
                                    fill="#0d6efd" />
                            </svg>
                        </button>
                        <button class="btn btn-link p-0 border-0" (click)="openModal(true, task.id)"
                            title="Editar Tarefa">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M17.7124 4.51054C17.9497 4.27366 18.2716 4.14044 18.6075 4.14044C18.9434 4.14044 19.2653 4.27366 19.5026 4.51054C19.7398 4.74739 19.8729 5.06847 19.8729 5.40308C19.8729 5.7377 19.7398 6.05877 19.5026 6.29563L11.6943 14.0916L9.30813 14.6872L9.90429 12.3063L17.7124 4.51054ZM18.6075 3.14044C18.0069 3.14044 17.4308 3.37863 17.0059 3.80287L9.09965 11.6966C9.03547 11.7607 8.98993 11.841 8.9679 11.929L8.13567 15.2526C8.09301 15.423 8.14286 15.6033 8.26701 15.7275C8.39115 15.8518 8.57138 15.9017 8.74178 15.8592L12.0707 15.0283C12.1586 15.0064 12.2388 14.961 12.3029 14.897L20.2091 7.00329C20.6341 6.57903 20.8729 6.00343 20.8729 5.40308C20.8729 4.80274 20.6341 4.22714 20.2091 3.80287C19.7842 3.37863 19.2081 3.14044 18.6075 3.14044ZM5.29154 4.9031C4.71775 4.9031 4.16729 5.13067 3.76131 5.53601C3.35531 5.94137 3.12708 6.49132 3.12708 7.06493V18.6978C3.12708 19.2714 3.35531 19.8213 3.76131 20.2267C4.16729 20.632 4.71775 20.8596 5.29154 20.8596H16.9428C17.5166 20.8596 18.0671 20.632 18.4731 20.2267C18.8791 19.8213 19.1073 19.2714 19.1073 18.6978V12.8814C19.1073 12.6052 18.8834 12.3814 18.6073 12.3814C18.3311 12.3814 18.1073 12.6052 18.1073 12.8814V18.6978C18.1073 19.0057 17.9848 19.3011 17.7665 19.519C17.5482 19.737 17.2519 19.8596 16.9428 19.8596H5.29154C4.98245 19.8596 4.68618 19.737 4.46786 19.519C4.24957 19.3011 4.12708 19.0057 4.12708 18.6978V7.06493C4.12708 6.75705 4.24957 6.46162 4.46786 6.24367C4.68618 6.0257 4.98245 5.9031 5.29154 5.9031H11.1172C11.3933 5.9031 11.6172 5.67924 11.6172 5.4031C11.6172 5.12696 11.3933 4.9031 11.1172 4.9031H5.29154Z"
                                    fill="#0d6efd" />
                            </svg>
                        </button>
                        <button class="btn btn-link p-0 border-0" title="Excluir Tarefa" (click)="deleteTask(task.id)">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M10 2.5C9.60218 2.5 9.22064 2.65804 8.93934 2.93934C8.65804 3.22064 8.5 3.60218 8.5 4V5.5H15.5V4C15.5 3.60218 15.342 3.22064 15.0607 2.93934C14.7794 2.65804 14.3978 2.5 14 2.5H10ZM16.5 5.5V4C16.5 3.33696 16.2366 2.70107 15.7678 2.23223C15.2989 1.76339 14.663 1.5 14 1.5H10C9.33696 1.5 8.70107 1.76339 8.23223 2.23223C7.76339 2.70107 7.5 3.33696 7.5 4V5.5H5H3C2.72386 5.5 2.5 5.72386 2.5 6C2.5 6.27614 2.72386 6.5 3 6.5H4.5V20C4.5 20.663 4.76339 21.2989 5.23223 21.7678C5.70107 22.2366 6.33696 22.5 7 22.5H17C17.663 22.5 18.2989 22.2366 18.7678 21.7678C19.2366 21.2989 19.5 20.663 19.5 20V6.5H21C21.2761 6.5 21.5 6.27614 21.5 6C21.5 5.72386 21.2761 5.5 21 5.5H19H16.5ZM18.5 6.5H16H8H5.5V20C5.5 20.3978 5.65804 20.7794 5.93934 21.0607C6.22064 21.342 6.60218 21.5 7 21.5H17C17.3978 21.5 17.7794 21.342 18.0607 21.0607C18.342 20.7794 18.5 20.3978 18.5 20V6.5ZM10.5 11C10.5 10.7239 10.2761 10.5 10 10.5C9.72386 10.5 9.5 10.7239 9.5 11V17C9.5 17.2761 9.72386 17.5 10 17.5C10.2761 17.5 10.5 17.2761 10.5 17V11ZM14.5 11C14.5 10.7239 14.2761 10.5 14 10.5C13.7239 10.5 13.5 10.7239 13.5 11V17C13.5 17.2761 13.7239 17.5 14 17.5C14.2761 17.5 14.5 17.2761 14.5 17V11Z"
                                    fill="#0d6efd" />
                            </svg>
                        </button>
                    </div>
                    <ng-template #Concluido>
                        <svg title="Tarefa Concluída!" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M7.84873 3.3108C9.01571 1.25938 10.5604 3.8147e-06 12.229 3.8147e-06C13.9383 3.8147e-06 15.4565 1.32156 16.5342 3.46232C18.6815 3.11365 20.467 3.4769 21.4487 4.64686C22.3162 5.68074 22.4227 7.18561 21.8953 8.88427C23.2229 9.88501 24 11.0742 24 12.3325C24 13.7779 22.9745 15.0754 21.2669 16.0631C21.707 17.6771 21.5924 19.0694 20.8161 19.9946C19.8681 21.1244 18.1031 21.3552 15.9804 20.8192C14.8226 22.7937 13.3083 24 11.6752 24C10.0252 24 8.55313 22.7685 7.48365 20.7573C5.36547 21.0881 3.60623 20.7204 2.6345 19.5623C1.74674 18.5044 1.65595 16.9531 2.2258 15.2058C0.824444 14.1868 0 12.964 0 11.6679C0 10.315 0.898346 9.09175 2.41349 8.13085C1.93753 6.46968 2.03923 5.03468 2.8333 4.08834C3.80795 2.92679 5.64607 2.71548 7.84873 3.3108Z"
                                fill="#3767B2" />
                            <path d="M16.8306 8.90491L13.7368 11.9049L10.6431 14.9049L7.83057 12.1776" stroke="white"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>

                        <button class="btn btn-link p-0 border-0 ms-2" title="Reverter" (click)="toggleComplete(task)">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M17.5955 3.68585C15.7929 2.68937 13.7153 2.30571 11.6757 2.59266C9.63871 2.87926 7.7498 3.81932 6.2929 5.27141L2.50073 8.83474V3.99068C2.50073 3.71453 2.27687 3.49068 2.00073 3.49068C1.72459 3.49068 1.50073 3.71453 1.50073 3.99068V9.98953C1.50072 9.99654 1.50084 10.0036 1.50112 10.0106C1.50342 10.0695 1.51591 10.1257 1.53688 10.1777C1.55574 10.2245 1.582 10.2691 1.61571 10.3097C1.62538 10.3213 1.63557 10.3326 1.64624 10.3433C1.7368 10.4343 1.86219 10.4907 2.00073 10.4907H8.00073C8.27688 10.4907 8.50073 10.2668 8.50073 9.99067C8.50073 9.71453 8.27688 9.49067 8.00073 9.49067H3.263L6.98312 5.99505L6.99399 5.98452C8.29818 4.68253 9.99019 3.83966 11.8151 3.58291C13.64 3.32616 15.4988 3.66944 17.1117 4.56102C18.7245 5.45261 20.0039 6.8442 20.757 8.52612C21.5102 10.208 21.6963 12.0892 21.2874 13.8861C20.8785 15.683 19.8967 17.2983 18.4899 18.4887C17.0831 19.6791 15.3275 20.3801 13.4877 20.486C11.6479 20.5919 9.82352 20.097 8.28944 19.0758C6.75536 18.0547 5.59469 16.5627 4.98232 14.8245C4.89056 14.5641 4.60504 14.4273 4.34458 14.5191C4.08413 14.6108 3.94738 14.8964 4.03914 15.1568C4.72356 17.0994 6.02078 18.767 7.73534 19.9083C9.4499 21.0495 11.4889 21.6027 13.5452 21.4843C15.6014 21.366 17.5635 20.5826 19.1358 19.2521C20.7081 17.9217 21.8055 16.1163 22.2625 14.108C22.7195 12.0997 22.5115 9.99722 21.6697 8.11742C20.8279 6.23763 19.398 4.68232 17.5955 3.68585Z" fill="#0d6efd"/>
                            </svg>
                        </button>
                            
                    </ng-template>
                </td>
                <td class="text-center">
                    <div>
                        <span class="badge rounded-pill bg-success"
                            *ngIf="task.isTaskConcluida; else isNotTaskConcluida">
                            Concluída
                        </span>
                        <ng-template #isNotTaskConcluida>
                            <span class="badge rounded-pill bg-warning ">
                                Pendente
                            </span>
                        </ng-template>
                    </div>
                </td>
                <td class="fit-content w-25">{{ task.nomeTask }}</td>
                <td class="fit-content w-25" >{{ task.descricaoTask }}</td>
                <td>{{ task.id }}</td>
            </tr>
        </tbody>
    </table>
</div>

<ng-container *ngIf="isModalOpen">
    <div class="modal fade show d-block" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{ editingMode ? 'Editar Tarefa' : 'Nova Tarefa' }}</h5>
                    <button type="button" class="btn-close" (click)="closeModal()"></button>
                </div>
                <div class="modal-body">
                    <form [formGroup]="taskForm">
                        <div class="mb-3">
                            <label for="taskName" class="form-label">Nome da Tarefa</label>
                            <input type="text" class="form-control" id="taskName" formControlName="txNomeTask" maxlength="25">
                        </div>
                        <div class="mb-3">
                            <label for="taskDescription" class="form-label">Descrição</label>
                            <textarea class="form-control" 
                            id="taskDescription"
                            formControlName="txDescricaoTask"
                            maxlength="50"
                            rows="3"></textarea>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="taskCompleted"
                                formControlName="isConcluida">
                            <label class="form-check-label" for="taskCompleted">Tarefa Concluída</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
                    <button type="button" class="btn btn-primary" [disabled]="taskForm.invalid"
                        (click)="saveTask(); closeModal()">
                        {{ editingMode ? 'Salvar Alterações' : 'Salvar' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Backdrop manual -->
    <div class="modal-backdrop fade show"></div>
</ng-container>